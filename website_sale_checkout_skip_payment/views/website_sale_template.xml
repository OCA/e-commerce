<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Copyright 2017 Sergio Teruel <sergio.teruel@tecnativa.com>
         License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl). -->
    <template id="payment" inherit_id="website_sale.payment" priority="25">
        <xpath expr="//div[hasclass('js_payment')]" position="after">
            <div class="row">
                <div class="col float-start mt-2" t-if="website.checkout_skip_payment">
                    <a role="button" href="/shop/cart" class="btn btn-secondary">
                        <i class="fa fa-chevron-left" /> Return to Cart </a>
                </div>
                <div
                    class="col js_skip_payment mt-2"
                    t-if="website.checkout_skip_payment"
                    id="skip_payment_method"
                >
                    <form
                        target="_self"
                        action="/shop/confirmation"
                        method="post"
                        class="float-right"
                    >
                        <input
                            type="hidden"
                            name="csrf_token"
                            t-att-value="request.csrf_token()"
                        />
                        <a
                            role="button"
                            class="float-end btn btn-primary a-submit"
                            href="#"
                        >
                            <span>Confirm <span class="fa fa-chevron-right" /></span>
                        </a>
                    </form>
                </div>
            </div>
        </xpath>
        <xpath
            expr="//t[@t-if='website_sale_order.amount_total']"
            position="attributes"
        >
            <attribute
                name="t-if"
                separator=" "
                add="and not website.checkout_skip_payment"
            />
        </xpath>
        <xpath expr="//div[hasclass('js_payment')]" position="attributes">
            <attribute
                name="t-if"
            >not website_sale_order.amount_total and not website.checkout_skip_payment</attribute>
        </xpath>
    </template>
    <template id="confirmation" inherit_id="website_sale.confirmation">
        <xpath
            expr='//t[@t-if="payment_tx_id.state == &apos;done&apos;"]'
            position="attributes"
        >
            <attribute
                name="t-if"
            >payment_tx_id.state == 'done' or (website.checkout_skip_payment and
                order.state == 'sale')</attribute>
        </xpath>
        <xpath
            expr="//t[@t-call='website_sale.payment_confirmation_status']"
            position="after"
        >
            <div
                class="alert alert-info"
                role="alert"
                t-if="website.checkout_skip_payment"
            >
                <span t-field="website.website_sale_checkout_skip_message" />
            </div>
        </xpath>
        <!-- Hide payment related info if skip payment step -->
        <xpath
            expr="//t[@t-call='website_sale.payment_confirmation_status']"
            position="attributes"
        >
            <attribute name="t-if">not website.checkout_skip_payment</attribute>
        </xpath>
    </template>
    <template id="order_state_message">
        <p>Your order is waiting manual confirmation.</p>
        <br />
    </template>
    <template id="cart" inherit_id="website_sale.cart">
        <xpath expr="//div[hasclass('flex-column')]" position="attributes">
            <attribute name="class" add="d-none" separator=" " />
        </xpath>
        <xpath expr="//div[hasclass('flex-column')]" position="after">
            <div
                class="d-flex flex-column"
                t-if="website_sale_order and website_sale_order.website_order_line"
            >
                <a
                    class="btn btn-primary float-end"
                    role="button"
                    t-attf-href="{{redirect_url}}"
                >
                    <t t-if="redirect_to_sign_in">
                        <span>Sign In</span>
                        <span class="fa fa-sign-in" />
                    </t>
                    <t t-else="">
                        <t t-if="website.checkout_skip_payment">
                            <span>Confirm</span>
                        </t>
                        <t t-else="">
                            <span>Process Checkout</span>
                        </t>
                        <span class="fa fa-chevron-right" />
                    </t>
                </a>
                <t t-call="payment.express_checkout" />
            </div>
        </xpath>
    </template>
    <template id="short_cart_summary" inherit_id="website_sale.short_cart_summary">
        <xpath expr="//a[hasclass('float-end')]" position="attributes">
            <attribute name="class" remove="d-xl-inline-block" separator=" " />
        </xpath>
        <xpath expr="//a[hasclass('float-end')]" position="after">
            <a
                role="button"
                t-if="website_sale_order and website_sale_order.website_order_line"
                class="btn btn-secondary float-end d-none d-xl-inline-block"
                t-attf-href="{{redirect_url}}"
            >
                <t t-if="redirect_to_sign_in">
                    <span>Sign In</span>
                    <span class="fa fa-sign-in" />
                </t>
                <t t-else="">
                    <t t-if="website.checkout_skip_payment">
                        <span>Confirm</span>
                    </t>
                    <t t-else="">
                        <span>Process to Checkout</span>
                    </t>
                    <span class="fa fa-chevron-right" />
                </t>
            </a>
        </xpath>
    </template>
</odoo>
